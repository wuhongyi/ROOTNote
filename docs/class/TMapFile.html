

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TMapFile &mdash; ROOT Note 1 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="TArchiveFile" href="TArchiveFile.html" />
    <link rel="prev" title="TKeyMapFile" href="TKeyMapFile.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ROOT Note
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">简介</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">简介</a></li>
</ul>
<p class="caption"><span class="caption-text">base类的使用</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">类的使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="TObject.html">TObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="TTask.html">TTask</a></li>
<li class="toctree-l1"><a class="reference internal" href="Buttons.html">Buttons</a></li>
<li class="toctree-l1"><a class="reference internal" href="TNamed.html">TNamed</a></li>
<li class="toctree-l1"><a class="reference internal" href="TStyle.html">TStyle</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSystem.html">TSystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="TROOT.html">TROOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFolder.html">TFolder</a></li>
<li class="toctree-l1"><a class="reference internal" href="TEnv.html">TEnv</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMacro.html">TMacro</a></li>
<li class="toctree-l1"><a class="reference internal" href="TApplication.html">TApplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="TProcessID.html">TProcessID</a></li>
<li class="toctree-l1"><a class="reference internal" href="TProcessUUID.html">TProcessUUID</a></li>
<li class="toctree-l1"><a class="reference internal" href="TString.html">TString</a></li>
<li class="toctree-l1"><a class="reference internal" href="TColor.html">TColor</a></li>
<li class="toctree-l1"><a class="reference internal" href="TBase64.html">TBase64</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMD5.html">TMD5</a></li>
</ul>
<p class="caption"><span class="caption-text">IO类的使用</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">类的使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="TKey.html">TKey</a></li>
<li class="toctree-l1"><a class="reference internal" href="TDirectory.html">TDirectory</a></li>
<li class="toctree-l1"><a class="reference internal" href="TDirectoryFile.html">TDirectoryFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSystemFile.html">TSystemFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSystemDirectory.html">TSystemDirectory</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFile.html">TFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFileCacheWrite.html">TFileCacheWrite</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFileCacheRead.html">TFileCacheRead</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFileMerger.html">TFileMerger</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMemFile.html">TMemFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TKeyMapFile.html">TKeyMapFile</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">TMapFile</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#class">class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TArchiveFile.html">TArchiveFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TZIPFile.html">TZIPFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFilePrefetch.html">TFilePrefetch</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFPBlock.html">TFPBlock</a></li>
<li class="toctree-l1"><a class="reference internal" href="THDFSFile.html">THDFSFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TBuffer.html">TBuffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="TBufferFile.html">TBufferFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TBufferJSON.html">TBufferJSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="TKeySQL.html">TKeySQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSQLObjectData.html">TSQLObjectData</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSQLStructure.html">TSQLStructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSQLClassInfo.html">TSQLClassInfo</a></li>
<li class="toctree-l1"><a class="reference internal" href="TBufferSQL2.html">TBufferSQL2</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSQLFile.html">TSQLFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TXMLEngine.html">TXMLEngine</a></li>
<li class="toctree-l1"><a class="reference internal" href="TBufferXML.html">TBufferXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="TXMLSetup.html">TXMLSetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="TKeyXML.html">TKeyXML</a></li>
<li class="toctree-l1"><a class="reference internal" href="TXMLPlayer.html">TXMLPlayer</a></li>
<li class="toctree-l1"><a class="reference internal" href="TXMLFile.html">TXMLFile</a></li>
</ul>
<p class="caption"><span class="caption-text">常用类的使用</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">类的使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="TTree.html">TTree</a></li>
<li class="toctree-l1"><a class="reference internal" href="TCut.html">TCut</a></li>
<li class="toctree-l1"><a class="reference internal" href="TTreePlayer.html">TTreePlayer</a></li>
<li class="toctree-l1"><a class="reference internal" href="TChain.html">TChain</a></li>
<li class="toctree-l1"><a class="reference internal" href="TEventList.html">TEventList</a></li>
<li class="toctree-l1"><a class="reference internal" href="TBranch.html">TBranch</a></li>
<li class="toctree-l1"><a class="reference internal" href="TNtuple.html">TNtuple</a></li>
<li class="toctree-l1"><a class="reference internal" href="TNtupleD.html">TNtupleD</a></li>
<li class="toctree-l1"><a class="reference internal" href="TCollection.html">TCollection</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSeqCollection.html">TSeqCollection</a></li>
<li class="toctree-l1"><a class="reference internal" href="TList.html">TList</a></li>
<li class="toctree-l1"><a class="reference internal" href="TVirtualFitter.html">TVirtualFitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="TBackCompFitter.html">TBackCompFitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="FitResult.html">FitResult</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFitter.html">TFitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFitResult.html">TFitResult</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFitResultPtr.html">TFitResultPtr</a></li>
<li class="toctree-l1"><a class="reference internal" href="TFractionFitter.html">TFractionFitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="TLinearFitter.html">TLinearFitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="TAttAxis.html">TAttAxis</a></li>
<li class="toctree-l1"><a class="reference internal" href="TAxis.html">TAxis</a></li>
<li class="toctree-l1"><a class="reference internal" href="TGaxis.html">TGaxis</a></li>
<li class="toctree-l1"><a class="reference internal" href="TGaxis.html#example">example</a></li>
<li class="toctree-l1"><a class="reference internal" href="TText.html">TText</a></li>
<li class="toctree-l1"><a class="reference internal" href="TPaveStats.html">TPaveStats</a></li>
<li class="toctree-l1"><a class="reference internal" href="TPolyMarker.html">TPolyMarker</a></li>
<li class="toctree-l1"><a class="reference internal" href="TPaveText.html">TPaveText</a></li>
<li class="toctree-l1"><a class="reference internal" href="TPolyMarker3D.html">TPolyMarker3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="TLatex.html">TLatex</a></li>
<li class="toctree-l1"><a class="reference internal" href="TLegend.html">TLegend</a></li>
<li class="toctree-l1"><a class="reference internal" href="TLegendEntry.html">TLegendEntry</a></li>
<li class="toctree-l1"><a class="reference internal" href="TLine.html">TLine</a></li>
<li class="toctree-l1"><a class="reference internal" href="TVirtualPad.html">TVirtualPad</a></li>
<li class="toctree-l1"><a class="reference internal" href="TPad.html">TPad</a></li>
<li class="toctree-l1"><a class="reference internal" href="TCanvas.html">TCanvas</a></li>
<li class="toctree-l1"><a class="reference internal" href="TF1.html">TF1</a></li>
<li class="toctree-l1"><a class="reference internal" href="TF2.html">TF2</a></li>
<li class="toctree-l1"><a class="reference internal" href="TF3.html">TF3</a></li>
<li class="toctree-l1"><a class="reference internal" href="TGraph.html">TGraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="TCutG.html">TCutG</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMultiGraph.html">TMultiGraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="TGraph2D.html">TGraph2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="TGraph2DErrors.html">TGraph2DErrors</a></li>
<li class="toctree-l1"><a class="reference internal" href="TGraphErrors.html">TGraphErrors</a></li>
<li class="toctree-l1"><a class="reference internal" href="TGraphPolar.html">TGraphPolar</a></li>
<li class="toctree-l1"><a class="reference internal" href="TH1.html">TH1</a></li>
<li class="toctree-l1"><a class="reference internal" href="TH2.html">TH2</a></li>
<li class="toctree-l1"><a class="reference internal" href="TH2Poly.html">TH2Poly</a></li>
<li class="toctree-l1"><a class="reference internal" href="TH3.html">TH3</a></li>
<li class="toctree-l1"><a class="reference internal" href="TProfile.html">TProfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="TProfile2D.html">TProfile2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="TProfile3D.html">TProfile3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMath.html">TMath</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMathBase.html">TMathBase</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMatrixT.html">TMatrixT</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMatrixTBase.html">TMatrixTBase</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMatrixTSparse.html">TMatrixTSparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMatrixTSym.html">TMatrixTSym</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSpline.html">TSpline</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMinuit.html">TMinuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMinuitMinimizer.html">TMinuitMinimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="TRandom.html">TRandom</a></li>
<li class="toctree-l1"><a class="reference internal" href="TRandom1.html">TRandom1</a></li>
<li class="toctree-l1"><a class="reference internal" href="TRandom2.html">TRandom2</a></li>
<li class="toctree-l1"><a class="reference internal" href="TRandom3.html">TRandom3</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSelector.html">TSelector</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSelectorCint.html">TSelectorCint</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSelectorDraw.html">TSelectorDraw</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSelectorEntries.html">TSelectorEntries</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSelectorList.html">TSelectorList</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSelectorScalar.html">TSelectorScalar</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSpectrum.html">TSpectrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSpectrum2.html">TSpectrum2</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSpectrum2Fit.html">TSpectrum2Fit</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSpectrum2Painter.html">TSpectrum2Painter</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSpectrum2Transform.html">TSpectrum2Transform</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSpectrum3.html">TSpectrum3</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSpectrumFit.html">TSpectrumFit</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSpectrumTransform.html">TSpectrumTransform</a></li>
<li class="toctree-l1"><a class="reference internal" href="TTime.html">TTime</a></li>
<li class="toctree-l1"><a class="reference internal" href="TTimer.html">TTimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="TTimeStamp.html">TTimeStamp</a></li>
<li class="toctree-l1"><a class="reference internal" href="TStopwatch.html">TStopwatch</a></li>
<li class="toctree-l1"><a class="reference internal" href="TBenchmark.html">TBenchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="TThread.html">TThread</a></li>
<li class="toctree-l1"><a class="reference internal" href="TThreadFactory.html">TThreadFactory</a></li>
<li class="toctree-l1"><a class="reference internal" href="TThreadImp.html">TThreadImp</a></li>
<li class="toctree-l1"><a class="reference internal" href="TServerSocket.html">TServerSocket</a></li>
<li class="toctree-l1"><a class="reference internal" href="TSocket.html">TSocket</a></li>
<li class="toctree-l1"><a class="reference internal" href="TPServerSocket.html">TPServerSocket</a></li>
<li class="toctree-l1"><a class="reference internal" href="TPSocket.html">TPSocket</a></li>
<li class="toctree-l1"><a class="reference internal" href="TEllipse.html">TEllipse</a></li>
<li class="toctree-l1"><a class="reference internal" href="TNeuron.html">TNeuron</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMLPAnalyzer.html">TMLPAnalyzer</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMonitor.html">TMonitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="TMultiLayerPerceptron.html">TMultiLayerPerceptron</a></li>
</ul>
<p class="caption"><span class="caption-text">图形界面的使用</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gui/README.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/GuiTypes.html">GuiTypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGButton.html">TGButton</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGButtonGroup.html">TGButtonGroup</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGCanvas.html">TGCanvas</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGClient.html">TGClient</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGColorDialog.html">TGColorDialog</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGColorSelect.html">TGColorSelect</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGComboBox.html">TGComboBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGCommandPlugin.html">TGCommandPlugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGDimension.html">TGDimension</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGDNDManager.html">TGDNDManager</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGDockableFrame.html">TGDockableFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGDoubleSlider.html">TGDoubleSlider</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGEventHandler.html">TGEventHandler</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGFileBrowser.html">TGFileBrowser</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGFileDialog.html">TGFileDialog</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGFont.html">TGFont</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGFontDialog.html">TGFontDialog</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGFrame.html">TGFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGFSComboBox.html">TGFSComboBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGFSContainer.html">TGFSContainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGGC.html">TGGC</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGIcon.html">TGIcon</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGIdleHandler.html">TGIdleHandler</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGImageMap.html">TGImageMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGInputDialog.html">TGInputDialog</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGLabel.html">TGLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGLayout.html">TGLayout</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGListBox.html">TGListBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGListTree.html">TGListTree</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGListView.html">TGListView</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGMdiDecorFrame.html">TGMdiDecorFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGMdiFrame.html">TGMdiFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGMdiMainFrame.html">TGMdiMainFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGMdiMenu.html">TGMdiMenu</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGMenu.html">TGMenu</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGMimeTypes.html">TGMimeTypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGMsgBox.html">TGMsgBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGNumberEntry.html">TGNumberEntry</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGObject.html">TGObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGPack.html">TGPack</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGPasswdDialog.html">TGPasswdDialog</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGPicture.html">TGPicture</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGProgressBar.html">TGProgressBar</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGRedirectOutputGuard.html">TGRedirectOutputGuard</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGResourcePool.html">TGResourcePool</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGScrollBar.html">TGScrollBar</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGShapedFrame.html">TGShapedFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGShutter.html">TGShutter</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGSimpleTable.html">TGSimpleTable</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGSimpleTableInterface.html">TGSimpleTableInterface</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGSlider.html">TGSlider</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGSpeedo.html">TGSpeedo</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGSplitFrame.html">TGSplitFrame</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGSplitter.html">TGSplitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGStatusBar.html">TGStatusBar</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGString.html">TGString</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTab.html">TGTab</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTable.html">TGTable</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTableCell.html">TGTableCell</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTableContainer.html">TGTableContainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTableHeader.html">TGTableHeader</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTableLayout.html">TGTableLayout</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGText.html">TGText</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTextBuffer.html">TGTextBuffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTextEdit.html">TGTextEdit</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTextEditDialogs.html">TGTextEditDialogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTextEditor.html">TGTextEditor</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTextEntry.html">TGTextEntry</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTextView.html">TGTextView</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTextViewStream.html">TGTextViewStream</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGToolBar.html">TGToolBar</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGToolTip.html">TGToolTip</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGTripleSlider.html">TGTripleSlider</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGuiBuilder.html">TGuiBuilder</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGView.html">TGView</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGWidget.html">TGWidget</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGWindow.html">TGWindow</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TGXYLayout.html">TGXYLayout</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TQObject.html">TQObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui/TRootEmbeddedCanvas.html">TRootEmbeddedCanvas</a></li>
</ul>
<p class="caption"><span class="caption-text">GRAF3D</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="graf3d/README.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TAxis3D.html">TAxis3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TBRIK.html">TBRIK</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TCONE.html">TCONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TCONS.html">TCONS</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TCTUB.html">TCTUB</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TELTU.html">TELTU</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TGeometry.html">TGeometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TGTRA.html">TGTRA</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/THelix.html">THelix</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/THYPE.html">THYPE</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TMarker3DBox.html">TMarker3DBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TMaterial.html">TMaterial</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TMixture.html">TMixture</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TNodeDiv.html">TNodeDiv</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TNode.html">TNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TPARA.html">TPARA</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TPCON.html">TPCON</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TPGON.html">TPGON</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TPoints3DABC.html">TPoints3DABC</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TPointSet3D.html">TPointSet3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TPolyLine3D.html">TPolyLine3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TPolyMarker3D.html">TPolyMarker3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TRotMatrix.html">TRotMatrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TShape.html">TShape</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TSPHE.html">TSPHE</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TTRAP.html">TTRAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TTRD1.html">TTRD1</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TTRD2.html">TTRD2</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TTUBE.html">TTUBE</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TTUBS.html">TTUBS</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TView3D.html">TView3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/TXTRU.html">TXTRU</a></li>
<li class="toctree-l1"><a class="reference internal" href="graf3d/X3DBuffer.html">X3DBuffer</a></li>
</ul>
<p class="caption"><span class="caption-text">physics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="math/README.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TFeldmanCousins.html">TFeldmanCousins</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TGenPhaseSpace.html">TGenPhaseSpace</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TLorentzRotation.html">TLorentzRotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TLorentzVector.html">TLorentzVector</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TQuaternion.html">TQuaternion</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TRobustEstimator.html">TRobustEstimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TRolke.html">TRolke</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TRotation.html">TRotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TVectorT.html">TVectorT</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TVector2.html">TVector2</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/TVector3.html">TVector3</a></li>
</ul>
<p class="caption"><span class="caption-text">net</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="net/README.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="net/TCivetweb.html">TCivetweb</a></li>
<li class="toctree-l1"><a class="reference internal" href="net/TFastCgi.html">TFastCgi</a></li>
<li class="toctree-l1"><a class="reference internal" href="net/THttpCallArg.html">THttpCallArg</a></li>
<li class="toctree-l1"><a class="reference internal" href="net/THttpEngine.html">THttpEngine</a></li>
<li class="toctree-l1"><a class="reference internal" href="net/THttpServer.html">THttpServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="net/THttpWSEngine.html">THttpWSEngine</a></li>
<li class="toctree-l1"><a class="reference internal" href="net/THttpWSHandler.html">THttpWSHandler</a></li>
<li class="toctree-l1"><a class="reference internal" href="net/TRootSniffer.html">TRootSniffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="net/TRootSnifferStore.html">TRootSnifferStore</a></li>
</ul>
<p class="caption"><span class="caption-text">数据结构</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../structure/README.html">数据结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/datarecord.html">datarecord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/dobject.html">dataobject</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/freesegments.html">FreeSegments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/gap.html">gap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/header.html">header</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/keyslist.html">KeysList</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/StreamerInfo.html">StreamerInfo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/TClonesArray.html">TClonesArray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/TDirectory.html">TDirectory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/TFile.html">TFile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/TObject.html">TObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/TProcessID.html">TProcessID</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/TRefArray.html">TRefArray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/TRef.html">TRef</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure/TTree.html">TTree</a></li>
</ul>
<p class="caption"><span class="caption-text">预定义</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../define/README.html">预定义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../define/RVersion.html">RVersion</a></li>
</ul>
<p class="caption"><span class="caption-text">文件版本</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../version/version.html">文件更新版本</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ROOT Note</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>TMapFile</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/class/TMapFile.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!-- TMapFile.md --- 
;; 
;; Description: 
;; Author: Hongyi Wu(吴鸿毅)
;; Email: wuhongyi@qq.com 
;; Created: 日 1月  6 14:46:33 2019 (+0800)
;; Last-Updated: 日 1月  6 15:03:24 2019 (+0800)
;;           By: Hongyi Wu(吴鸿毅)
;;     Update #: 1
;; URL: http://wuhongyi.cn --><div class="section" id="tmapfile">
<h1>TMapFile<a class="headerlink" href="#tmapfile" title="永久链接至标题">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This class implements a shared memory region mapped to a file.
Objects can be placed into this shared memory area using the Add()
member function. To actually place a copy of the object is shared
memory call Update() also whenever the mapped object(s) change(s)
call Update() to put a fresh copy in the shared memory. This extra
step is necessary since it is not possible to share objects with
virtual pointers between processes (the vtbl ptr points to the
originators unique address space and can not be used by the
consumer process(es)). Consumer processes can map the memory region
from this file and access the objects stored in it via the Get()
method (which returns a copy of the object stored in the shared
memory with correct vtbl ptr set). Only objects of classes with a
Streamer() member function defined can be shared.

I know the current implementation is not ideal (you need to copy to
and from the shared memory file) but the main problem is with the
class&#39; virtual_table pointer. This pointer points to a table unique
for every process. Therefore, different options are:
  -# One could allocate an object directly in shared memory in the
     producer, but the consumer still has to copy the object from
     shared memory into a local object which has the correct vtbl
     pointer for that process (copy ctor&#39;s can be used for creating
     the local copy).
  -# Another possibility is to only allow objects without virtual
     functions in shared memory (like simple C structs), or to
     forbid (how?) the consumer from calling any virtual functions
     of the objects in shared memory.
  -# A last option is to copy the object internals to shared memory
     and copy them again from there. This is what is done in the
     TMapFile (using the object Streamer() to make a deep copy).

Option 1) saves one copy, but requires solid copy ctor&#39;s (along the
full inheritance chain) to rebuild the object in the consumer. Most
classes don&#39;t provide these copy ctor&#39;s, especially not when objects
contain collections, etc. 2) is too limiting or dangerous (calling
accidentally a virtual function will segv). So since we have a
robust Streamer mechanism I opted for 3).
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TMapFile</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TObject</span>
</pre></div>
</div>
<div class="section" id="class">
<h2>class<a class="headerlink" href="#class" title="永久链接至标题">¶</a></h2>
<p><strong>TMapFile</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">friend</span> <span class="k">class</span> <span class="nc">TMapRec</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
   <span class="n">Int_t</span>       <span class="n">fFd</span><span class="p">;</span>             <span class="c1">///&lt; Descriptor of mapped file</span>
   <span class="n">Int_t</span>       <span class="n">fVersion</span><span class="p">;</span>        <span class="c1">///&lt; ROOT version (or -1 for shadow map file)</span>
   <span class="kt">char</span>       <span class="o">*</span><span class="n">fName</span><span class="p">;</span>           <span class="c1">///&lt; Name of mapped file</span>
   <span class="kt">char</span>       <span class="o">*</span><span class="n">fTitle</span><span class="p">;</span>          <span class="c1">///&lt; Title of mapped file</span>
   <span class="kt">char</span>       <span class="o">*</span><span class="n">fOption</span><span class="p">;</span>         <span class="c1">///&lt; Directory creation options</span>
   <span class="kt">void</span>       <span class="o">*</span><span class="n">fMmallocDesc</span><span class="p">;</span>    <span class="c1">///&lt; Pointer to mmalloc descriptor</span>
   <span class="n">ULong_t</span>     <span class="n">fBaseAddr</span><span class="p">;</span>       <span class="c1">///&lt; Base address of mapped memory region</span>
   <span class="n">Int_t</span>       <span class="n">fSize</span><span class="p">;</span>           <span class="c1">///&lt; Original start size of memory mapped region</span>
   <span class="n">TMapRec</span>    <span class="o">*</span><span class="n">fFirst</span><span class="p">;</span>          <span class="c1">///&lt; List of streamed objects is shared memory</span>
   <span class="n">TMapRec</span>    <span class="o">*</span><span class="n">fLast</span><span class="p">;</span>           <span class="c1">///&lt; Last object in list of shared objects</span>
   <span class="n">Long_t</span>      <span class="n">fOffset</span><span class="p">;</span>         <span class="c1">///&lt; Offset in bytes for region mapped by reader</span>
   <span class="n">TDirectory</span> <span class="o">*</span><span class="n">fDirectory</span><span class="p">;</span>      <span class="c1">///&lt; Pointer to directory associated to this mapfile</span>
   <span class="n">TList</span>      <span class="o">*</span><span class="n">fBrowseList</span><span class="p">;</span>     <span class="c1">///&lt; List of KeyMapFile objects</span>
   <span class="n">Bool_t</span>      <span class="n">fWritable</span><span class="p">;</span>       <span class="c1">///&lt; TRUE if mapped file opened in RDWR mode</span>
   <span class="n">Int_t</span>       <span class="n">fSemaphore</span><span class="p">;</span>      <span class="c1">///&lt; Modification semaphore (or getpid() for WIN32)</span>
   <span class="n">ULong_t</span>     <span class="n">fhSemaphore</span><span class="p">;</span>     <span class="c1">///&lt; HANDLE of WIN32 Mutex object to implement semaphore</span>
   <span class="n">TObject</span>    <span class="o">*</span><span class="n">fGetting</span><span class="p">;</span>        <span class="c1">///&lt; Don&#39;t deadlock in update mode, when from Get() Add() is called</span>
   <span class="n">Int_t</span>       <span class="n">fWritten</span><span class="p">;</span>        <span class="c1">///&lt; Number of objects written sofar</span>
   <span class="n">Double_t</span>    <span class="n">fSumBuffer</span><span class="p">;</span>      <span class="c1">///&lt; Sum of buffer sizes of objects written sofar</span>
   <span class="n">Double_t</span>    <span class="n">fSum2Buffer</span><span class="p">;</span>     <span class="c1">///&lt; Sum of squares of buffer sizes of objects written so far</span>

   <span class="k">static</span> <span class="n">Long_t</span> <span class="n">fgMapAddress</span><span class="p">;</span>  <span class="c1">///&lt; Map to this address, set address via SetMapAddress()</span>
   <span class="k">static</span> <span class="kt">void</span>  <span class="o">*</span><span class="n">fgMmallocDesc</span><span class="p">;</span> <span class="c1">///&lt; Used in Close() and operator delete()</span>

<span class="k">protected</span><span class="o">:</span>
   <span class="n">TMapFile</span><span class="p">();</span>
   <span class="n">TMapFile</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">title</span><span class="p">,</span> <span class="n">Option_t</span> <span class="o">*</span><span class="n">option</span><span class="p">,</span> <span class="n">Int_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">TMapFile</span> <span class="o">*&amp;</span><span class="n">newMapFile</span><span class="p">);</span>
<span class="c1">/// Create a memory mapped file.</span>
<span class="c1">/// This opens a file (to which the</span>
<span class="c1">/// memory will be mapped) and attaches a memory region to it.</span>
<span class="c1">/// Option can be either: &quot;NEW&quot;, &quot;CREATE&quot;, &quot;RECREATE&quot;, &quot;UPDATE&quot; or</span>
<span class="c1">/// &quot;READ&quot; (see TFile). The default open mode is &quot;READ&quot;. The size</span>
<span class="c1">/// argument specifies the maximum size of shared memory file in bytes.</span>
<span class="c1">/// This protected ctor is called via the static Create() method.   </span>
   
   <span class="n">TMapFile</span><span class="p">(</span><span class="k">const</span> <span class="n">TMapFile</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">,</span> <span class="n">Long_t</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="c1">/// Private copy ctor.</span>
<span class="c1">/// Used by the the ctor to create a new version</span>
<span class="c1">/// of TMapFile in the memory mapped heap. It&#39;s main purpose is to</span>
<span class="c1">/// correctly create the string data members.   </span>
   
   <span class="kt">void</span>       <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TMapFile</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">);</span>  <span class="c1">// not implemented</span>

   <span class="n">TMapFile</span>  <span class="o">*</span><span class="nf">FindShadowMapFile</span><span class="p">();</span><span class="c1">/// Returns shadow map file.</span>
   <span class="kt">void</span>       <span class="nf">InitDirectory</span><span class="p">();</span><span class="c1">/// Create the directory associated to this mapfile</span>
   <span class="n">TObject</span>   <span class="o">*</span><span class="nf">Remove</span><span class="p">(</span><span class="n">TObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">Bool_t</span> <span class="n">lock</span><span class="p">);</span>
<span class="c1">/// Remove object from shared memory.</span>
<span class="c1">/// Returns pointer to removed object if successful, 0 otherwise.   </span>
   
   <span class="n">TObject</span>   <span class="o">*</span><span class="nf">Remove</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="n">Bool_t</span> <span class="n">lock</span><span class="p">);</span>
<span class="c1">/// Remove object by name from shared memory.</span>
<span class="c1">/// Returns pointer to removed object if successful, 0 otherwise.   </span>
   
   <span class="kt">void</span>       <span class="nf">SumBuffer</span><span class="p">(</span><span class="n">Int_t</span> <span class="n">bufsize</span><span class="p">);</span><span class="c1">/// Increment statistics for buffer sizes of objects in this file.</span>
   <span class="n">Int_t</span>      <span class="nf">GetBestBuffer</span><span class="p">();</span>
<span class="c1">/// Return the best buffer size for objects in this file.</span>
<span class="c1">/// The best buffer size is estimated based on the current mean value</span>
<span class="c1">/// and standard deviation of all objects written so far to this file.</span>
<span class="c1">/// Returns mean value + one standard deviation.</span>

   <span class="kt">void</span>   <span class="nf">CreateSemaphore</span><span class="p">(</span><span class="n">Int_t</span> <span class="n">pid</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span><span class="c1">/// Create semaphore used for synchronizing access to shared memory.</span>
   <span class="n">Int_t</span>  <span class="nf">AcquireSemaphore</span><span class="p">();</span><span class="c1">/// Acquire semaphore. Returns 0 if OK, -1 on error.</span>
   <span class="n">Int_t</span>  <span class="nf">ReleaseSemaphore</span><span class="p">();</span><span class="c1">/// Release semaphore. Returns 0 if OK, -1 on error.</span>
   <span class="kt">void</span>   <span class="nf">DeleteSemaphore</span><span class="p">();</span><span class="c1">/// Delete the semaphore.</span>

   <span class="k">static</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">MapToAddress</span><span class="p">();</span>
<span class="c1">/// Return the base address at which we would like the next TMapFile&#39;s</span>
<span class="c1">/// mapped data to start.</span>
<span class="c1">/// For now, we let the system decide (start address 0). There are</span>
<span class="c1">/// a lot of issues to deal with here to make this work reasonably,</span>
<span class="c1">/// including:</span>
<span class="c1">///   - Avoid memory collisions with existing mapped address spaces</span>
<span class="c1">///   - Reclaim address spaces when their mmalloc heaps are unmapped</span>
<span class="c1">///   - When mmalloc heaps are shared between processes they have to be</span>
<span class="c1">///   mapped at the same addresses in each</span>
<span class="c1">/// Once created, a mmalloc heap that is to be mapped back in must be</span>
<span class="c1">/// mapped at the original address.  I.e. each TMapFile will expect</span>
<span class="c1">/// to be remapped at it&#39;s original address. This becomes a problem if</span>
<span class="c1">/// the desired address is already in use.</span>

<span class="k">public</span><span class="o">:</span>
   <span class="k">enum</span> <span class="p">{</span> <span class="n">kDefaultMapSize</span> <span class="o">=</span> <span class="mh">0x80000</span> <span class="p">};</span> <span class="c1">// default size of mapped heap is 500 KB</span>

   <span class="c1">// Should both be protected (waiting for cint)</span>
   <span class="k">virtual</span> <span class="o">~</span><span class="n">TMapFile</span><span class="p">();</span>
<span class="c1">/// TMapFiles may not be deleted, since we want to keep the complete</span>
<span class="c1">/// TMapFile object in the mapped file for later re-use. To enforce this</span>
<span class="c1">/// the delete operator has been made private. Use Close() to properly</span>
<span class="c1">/// terminate a TMapFile (also done via the TROOT dtor).   </span>
   
   <span class="kt">void</span>     <span class="k">operator</span> <span class="nf">delete</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">vp</span><span class="p">);</span>

   <span class="kt">void</span>          <span class="nf">Browse</span><span class="p">(</span><span class="n">TBrowser</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span><span class="c1">/// Browse contents of TMapFile.</span>
   <span class="kt">void</span>          <span class="nf">Close</span><span class="p">(</span><span class="n">Option_t</span> <span class="o">*</span><span class="n">option</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="c1">/// Close a mapped file.</span>
<span class="c1">/// First detach mapped memory then close file.</span>
<span class="c1">/// No member functions of a TMapFile that was opened in write mode</span>
<span class="c1">/// may be called after Close() (this includes, of course, &quot;delete&quot; which</span>
<span class="c1">/// would call the dtors). The option=&quot;dtor&quot; is only used when called</span>
<span class="c1">/// via the ~TMapFile.   </span>
   
   <span class="kt">void</span>         <span class="o">*</span><span class="nf">GetBaseAddr</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">fBaseAddr</span><span class="p">;</span> <span class="p">}</span>
   <span class="kt">void</span>         <span class="o">*</span><span class="nf">GetBreakval</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="c1">/// Return the current location in the memory region for this malloc heap which</span>
<span class="c1">/// represents the end of memory in use. Returns 0 if map file was closed.   </span>
   
   <span class="n">TDirectory</span>   <span class="o">*</span><span class="nf">GetDirectory</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">fDirectory</span><span class="p">;}</span>
   <span class="n">Int_t</span>         <span class="nf">GetFd</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fFd</span><span class="p">;</span> <span class="p">}</span>
   <span class="kt">void</span>         <span class="o">*</span><span class="nf">GetMmallocDesc</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fMmallocDesc</span><span class="p">;</span> <span class="p">}</span>
   <span class="k">const</span> <span class="kt">char</span>   <span class="o">*</span><span class="nf">GetName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fName</span><span class="p">;</span> <span class="p">}</span>
   <span class="n">Int_t</span>         <span class="nf">GetSize</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fSize</span><span class="p">;</span> <span class="p">}</span>
   <span class="k">const</span> <span class="kt">char</span>   <span class="o">*</span><span class="nf">GetOption</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fOption</span><span class="p">;</span> <span class="p">}</span>
   <span class="k">const</span> <span class="kt">char</span>   <span class="o">*</span><span class="nf">GetTitle</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fTitle</span><span class="p">;</span> <span class="p">}</span>
   <span class="n">TMapRec</span>      <span class="o">*</span><span class="nf">GetFirst</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">TMapRec</span><span class="o">*</span><span class="p">)((</span><span class="n">Long_t</span><span class="p">)</span> <span class="n">fFirst</span> <span class="o">+</span> <span class="n">fOffset</span><span class="p">);</span> <span class="p">}</span>
   <span class="n">TMapRec</span>      <span class="o">*</span><span class="nf">GetLast</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">TMapRec</span><span class="o">*</span><span class="p">)((</span><span class="n">Long_t</span><span class="p">)</span> <span class="n">fLast</span> <span class="o">+</span> <span class="n">fOffset</span><span class="p">);</span> <span class="p">}</span>
   <span class="n">Bool_t</span>        <span class="nf">IsFolder</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span><span class="c1">/// Returns kTRUE in case object is a folder (i.e. contains browsable lists).</span>
   <span class="n">Bool_t</span>        <span class="nf">IsWritable</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fWritable</span><span class="p">;</span> <span class="p">}</span>
   <span class="kt">void</span>         <span class="o">*</span><span class="nf">OrgAddress</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="n">Long_t</span><span class="p">)</span><span class="n">addr</span> <span class="o">-</span> <span class="n">fOffset</span><span class="p">);</span> <span class="p">}</span>
   <span class="kt">void</span>          <span class="nf">Print</span><span class="p">(</span><span class="n">Option_t</span> <span class="o">*</span><span class="n">option</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span><span class="c1">/// Print some info about the mapped file.</span>
   <span class="kt">void</span>          <span class="nf">ls</span><span class="p">(</span><span class="n">Option_t</span> <span class="o">*</span><span class="n">option</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span><span class="c1">/// List contents of TMapFile.</span>
   <span class="n">Bool_t</span>        <span class="nf">cd</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span><span class="c1">/// Cd to associated directory.</span>

   <span class="kt">void</span>          <span class="nf">Add</span><span class="p">(</span><span class="k">const</span> <span class="n">TObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="c1">/// Add an object to the list of objects to be stored in shared memory.</span>
<span class="c1">/// To place the object actually into shared memory call Update().   </span>
   
   <span class="kt">void</span>          <span class="nf">Update</span><span class="p">(</span><span class="n">TObject</span> <span class="o">*</span><span class="n">obj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="c1">/// Update an object (or all objects, if obj == 0) in shared memory.   </span>
   
   <span class="n">TObject</span>      <span class="o">*</span><span class="nf">Remove</span><span class="p">(</span><span class="n">TObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">kTRUE</span><span class="p">);</span> <span class="p">}</span>
   <span class="n">TObject</span>      <span class="o">*</span><span class="nf">Remove</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Remove</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">kTRUE</span><span class="p">);</span> <span class="p">}</span>
   <span class="kt">void</span>          <span class="nf">RemoveAll</span><span class="p">();</span><span class="c1">/// Remove all objects from shared memory.</span>
   <span class="n">TObject</span>      <span class="o">*</span><span class="nf">Get</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="n">TObject</span> <span class="o">*</span><span class="n">retObj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="c1">/// Return pointer to object retrieved from shared memory.</span>
<span class="c1">/// The object must</span>
<span class="c1">/// be deleted after use. If delObj is a pointer to a previously allocated</span>
<span class="c1">/// object it will be deleted. Returns 0 in case object with the given</span>
<span class="c1">/// name does not exist.</span>

   <span class="k">static</span> <span class="n">TMapFile</span> <span class="o">*</span><span class="nf">Create</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="n">Option_t</span> <span class="o">*</span><span class="n">option</span><span class="o">=</span><span class="s">&quot;READ&quot;</span><span class="p">,</span> <span class="n">Int_t</span> <span class="n">size</span><span class="o">=</span><span class="n">kDefaultMapSize</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="c1">/// Create a memory mapped file.</span>
<span class="c1">/// This opens a file (to which the</span>
<span class="c1">/// memory will be mapped) and attaches a memory region to it.</span>
<span class="c1">/// Option can be either: &quot;NEW&quot;, &quot;CREATE&quot;, &quot;RECREATE&quot;, &quot;UPDATE&quot;</span>
<span class="c1">/// or &quot;READ&quot; (see TFile). The default open mode is &quot;READ&quot;. The size</span>
<span class="c1">/// argument specifies the maximum size of shared memory file in bytes.</span>
<span class="c1">/// TMapFile&#39;s can only be created via this method. Create() enforces that</span>
<span class="c1">/// a TMapFile is always on the memory mapped heap (when &quot;NEW&quot;, &quot;CREATE&quot;</span>
<span class="c1">/// or &quot;RECREATE&quot; are used).   </span>
   
   <span class="k">static</span> <span class="n">TMapFile</span> <span class="o">*</span><span class="nf">WhichMapFile</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
   <span class="k">static</span> <span class="kt">void</span>      <span class="nf">SetMapAddress</span><span class="p">(</span><span class="n">Long_t</span> <span class="n">addr</span><span class="p">);</span>
<span class="c1">/// Set preferred map address.</span>
<span class="c1">/// Find out preferred map address as follows:</span>
<span class="c1">///   -# Run consumer program to find the preferred map address. Remember begin of mapped region, i.e. 0x40b4c000</span>
<span class="c1">/// ~~~{.cpp}</span>
<span class="c1">/// $ root</span>
<span class="c1">/// root [0] m = TMapFile::Create(&quot;dummy.map&quot;, &quot;recreate&quot;, 10000000);</span>
<span class="c1">/// root [1] m.Print()</span>
<span class="c1">/// Memory mapped file:   dummy.map</span>
<span class="c1">/// Title:</span>
<span class="c1">/// Option:               CREATE</span>
<span class="c1">/// Mapped Memory region: 0x40b4c000 - 0x40d95f00 (2.29 MB)</span>
<span class="c1">/// Current breakval:     0x40b53000</span>
<span class="c1">/// root [2] .q</span>
<span class="c1">/// $ rm dummy.map</span>
<span class="c1">/// ~~~</span>
<span class="c1">///   -# Add to producer program, just before creating the TMapFile:</span>
<span class="c1">///    TMapFile::SetMapAddress(0x40b4c000);</span>
<span class="c1">/// Repeat this if more than one map file is being used.</span>
<span class="c1">/// The above procedure allow programs using, e.g., different number of</span>
<span class="c1">/// shared libraries (that cause the default mapping address to be</span>
<span class="c1">/// different) to create shared memory regions in the same location</span>
<span class="c1">/// without overwriting a shared library. The above assumes the consumer</span>
<span class="c1">/// program is larger (i.e. has more shared memory occupied) than the</span>
<span class="c1">/// producer. If this is not true inverse the procedure.   </span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>TMapRec</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">\class TMapRec</span>
<span class="cm">\ingroup IO</span>

<span class="cm">Keep track of an object in the mapped file.</span>

<span class="cm">A TMapFile contains a list of TMapRec objects which keep track of</span>
<span class="cm">the actual objects stored in the mapped file.</span>
<span class="cm">*/</span>

<span class="k">friend</span> <span class="k">class</span> <span class="nc">TMapFile</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
   <span class="kt">char</span>            <span class="o">*</span><span class="n">fName</span><span class="p">;</span>       <span class="c1">///&lt; Object name</span>
   <span class="kt">char</span>            <span class="o">*</span><span class="n">fClassName</span><span class="p">;</span>  <span class="c1">///&lt; Class name</span>
   <span class="n">TObject</span>         <span class="o">*</span><span class="n">fObject</span><span class="p">;</span>     <span class="c1">///&lt; Pointer to original object</span>
   <span class="kt">void</span>            <span class="o">*</span><span class="n">fBuffer</span><span class="p">;</span>     <span class="c1">///&lt; Buffer containing object of class name</span>
   <span class="n">Int_t</span>            <span class="n">fBufSize</span><span class="p">;</span>    <span class="c1">///&lt; Buffer size</span>
   <span class="n">TMapRec</span>         <span class="o">*</span><span class="n">fNext</span><span class="p">;</span>       <span class="c1">///&lt; Next MapRec in list</span>

   <span class="n">TMapRec</span><span class="p">(</span><span class="k">const</span> <span class="n">TMapRec</span><span class="o">&amp;</span><span class="p">);</span>            <span class="c1">// Not implemented.</span>
   <span class="n">TMapRec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TMapRec</span><span class="o">&amp;</span><span class="p">);</span> <span class="c1">// Not implemented.</span>

<span class="k">public</span><span class="o">:</span>
   <span class="n">TMapRec</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">TObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">Int_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
   <span class="o">~</span><span class="n">TMapRec</span><span class="p">();</span>
   <span class="k">const</span> <span class="kt">char</span>   <span class="o">*</span><span class="nf">GetName</span><span class="p">(</span><span class="n">Long_t</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)((</span><span class="n">Long_t</span><span class="p">)</span> <span class="n">fName</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span> <span class="p">}</span>
   <span class="k">const</span> <span class="kt">char</span>   <span class="o">*</span><span class="nf">GetClassName</span><span class="p">(</span><span class="n">Long_t</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)((</span><span class="n">Long_t</span><span class="p">)</span> <span class="n">fClassName</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span> <span class="p">}</span>
   <span class="kt">void</span>         <span class="o">*</span><span class="nf">GetBuffer</span><span class="p">(</span><span class="n">Long_t</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="n">Long_t</span><span class="p">)</span> <span class="n">fBuffer</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span> <span class="p">}</span>
   <span class="n">Int_t</span>         <span class="nf">GetBufSize</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fBufSize</span><span class="p">;</span> <span class="p">}</span>
   <span class="n">TObject</span>      <span class="o">*</span><span class="nf">GetObject</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
   <span class="n">TMapRec</span>      <span class="o">*</span><span class="nf">GetNext</span><span class="p">(</span><span class="n">Long_t</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">TMapRec</span> <span class="o">*</span><span class="p">)((</span><span class="n">Long_t</span><span class="p">)</span> <span class="n">fNext</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span> <span class="p">}</span>
</pre></div>
</div>
<!-- TMapFile.md ends here --></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="TArchiveFile.html" class="btn btn-neutral float-right" title="TArchiveFile" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="TKeyMapFile.html" class="btn btn-neutral float-left" title="TKeyMapFile" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Hongyi Wu(吴鸿毅)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>